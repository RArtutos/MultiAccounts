FROM ubuntu/squid:latest

# Create cache directory and set permissions
RUN mkdir -p /var/spool/squid && \
    chown -R proxy:proxy /var/spool/squid && \
    chmod 755 /var/spool/squid && \
    mkdir -p /var/run/squid && \
    chown -R proxy:proxy /var/run/squid && \
    chmod 755 /var/run/squid && \
    mkdir -p /var/log/squid && \
    chown -R proxy:proxy /var/log/squid && \
    chmod 755 /var/log/squid

USER proxy

# Initialize cache
RUN squid -z

CMD ["squid", "-N", "-d1"]