FROM ubuntu/squid:latest

# Install Python and required packages
RUN apt-get update && \
    apt-get install -y python3 python3-pip && \
    rm -rf /var/lib/apt/lists/*

# Create directories
RUN mkdir -p /usr/local/squid/rewriter /var/log/squid && \
    chown -R proxy:proxy /usr/local/squid/rewriter /var/log/squid

# Set working directory
WORKDIR /usr/local/squid

# Make rewriter executable
RUN chmod +x /usr/local/squid/rewriter/main.py

# Set default command
CMD ["squid", "-N", "-d1"]