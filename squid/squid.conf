# Basic Configuration
http_port 3128
visible_hostname squid-proxy

# Access Control
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 443         # https
acl CONNECT method CONNECT

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow localhost access
http_access allow localhost

# Mexico Proxy Configuration
cache_peer 45.166.110.64 parent 50100 0 no-query login=arturojkl:HQKxDbtCiC connect-fail-limit=3 proxy-only

# URL rewriter
url_rewrite_program /usr/local/squid/rewriter/main.py
url_rewrite_children 5 startup=1 idle=1 concurrency=10

# Cache settings
cache_dir ufs /var/spool/squid 1000 16 256
maximum_object_size 128 MB
cache_mem 256 MB

# Cookie handling
request_header_access Set-Cookie allow all
request_header_access Cookie allow all

# Headers
forwarded_for off
request_header_access X-Forwarded-For deny all
request_header_access Via allow all
request_header_access Cache-Control allow all

# Error handling
retry_on_error on

# Access control
http_access allow all

# Logging
logformat combined %>a %ui %un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st "%{Referer}>h" "%{User-Agent}>h" %Ss:%Sh
access_log stdio:/var/log/squid/access.log combined
cache_log /var/log/squid/cache.log
cache_store_log stdio:/var/log/squid/store.log
logfile_rotate 10