# Configuración básica
http_port 3128
https_port 3129 cert=/etc/squid/ssl/squid.crt key=/etc/squid/ssl/squid.key

# Memoria y caché
cache_mem 256 MB
maximum_object_size 1024 MB
cache_dir ufs /var/spool/squid 1000 16 256

# Configuración de proxy upstream para México
cache_peer 45.166.110.64 parent 50100 0 no-query no-digest proxy-only
cache_peer_access 45.166.110.64 allow streaming_domains
cache_peer_access 45.166.110.64 deny all

# ACLs
acl streaming_domains dstdomain .netflix.com .hbomax.com .disneyplus.com .primevideo.com
acl SSL_ports port 443
acl Safe_ports port 80 443
acl CONNECT method CONNECT
acl localnet src all

# Autenticación básica
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
auth_param basic realm Proxy
auth_param basic credentialsttl 2 hours
acl authenticated proxy_auth REQUIRED

# Reglas de acceso
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow authenticated streaming_domains
http_access allow localnet
http_access deny all

# Otras configuraciones
forwarded_for on
request_header_access Allow allow all
request_header_access Authorization allow all
request_header_access Proxy-Authorization allow all
request_header_access Proxy-Authenticate allow all
request_header_access WWW-Authenticate allow all
request_header_access X-Forwarded-For allow all
request_header_access Via allow all
request_header_access Cache-Control allow all

# Configuración de SSL Bump
ssl_bump server-first all
sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/lib/ssl_db -M 4MB
sslcrtd_children 5
ssl_bump bump all